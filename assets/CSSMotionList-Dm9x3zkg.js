import{a2 as e,r as t}from"./index-qgT8BKlr.js";const n="add",s="keep",o="remove",r="removed";function a(e){let t;return t=e&&"object"==typeof e&&"key"in e?e:{key:e},{...t,key:String(t.key)}}function i(e=[]){return e.map(a)}function c(){return c=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},c.apply(this,arguments)}const p=["eventProps","visible","children","motionName","motionAppear","motionEnter","motionLeave","motionLeaveImmediately","motionDeadline","removeOnLeave","leavedClassName","onAppearPrepare","onAppearStart","onAppearActive","onAppearEnd","onEnterStart","onEnterActive","onEnterEnd","onLeaveStart","onLeaveActive","onLeaveEnd"];const l=function(a,l=e){class y extends t.Component{static defaultProps={component:"div"};state={keyEntities:[]};static getDerivedStateFromProps({keys:e},{keyEntities:t}){const a=i(e),c=function(e=[],t=[]){let r=[],a=0;const c=t.length,p=i(e),l=i(t);p.forEach(e=>{let t=!1;for(let o=a;o<c;o+=1){const i=l[o];if(i.key===e.key){a<o&&(r=r.concat(l.slice(a,o).map(e=>({...e,status:n}))),a=o),r.push({...i,status:s}),a+=1,t=!0;break}}t||r.push({...e,status:o})}),a<c&&(r=r.concat(l.slice(a).map(e=>({...e,status:n}))));const y={};return r.forEach(({key:e})=>{y[e]=(y[e]||0)+1}),Object.keys(y).filter(e=>y[e]>1).forEach(e=>{r=r.filter(({key:t,status:n})=>t!==e||n!==o),r.forEach(t=>{t.key===e&&(t.status=s)})}),r}(t,a);return{keyEntities:c.filter(e=>{const n=t.find(({key:t})=>e.key===t);return!n||n.status!==r||e.status!==o})}}removeKey=e=>{this.setState(t=>({keyEntities:t.keyEntities.map(t=>t.key!==e?t:{...t,status:r})}),()=>{const{keyEntities:e}=this.state;0===e.filter(({status:e})=>e!==r).length&&this.props.onAllRemoved&&this.props.onAllRemoved()})};render(){const{keyEntities:e}=this.state,{component:o,children:r,onVisibleChanged:a,onAllRemoved:i,...y}=this.props,m=o||t.Fragment,u={};return p.forEach(e=>{u[e]=y[e],delete y[e]}),delete y.keys,t.createElement(m,y,e.map(({status:e,...o},i)=>{const p=e===n||e===s;return t.createElement(l,c({},u,{key:o.key,visible:p,eventProps:o,onVisibleChanged:e=>{a?.(e,{key:o.key}),e||this.removeKey(o.key)}}),(e,t)=>r({...e,index:i},t))}))}}return y}();export{l as C};
