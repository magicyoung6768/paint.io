import{r as e,u as t,a as i,b as r,j as a,c as l,i as o}from"./index-DmJhNCd7.js";import{u as n,a as s}from"./useRequestManager-A0871YKO.js";import"./index-Doj6Cm60.js";import{I as d}from"./compiler-runtime-Bwq7bC82.js";import{B as c}from"./http-BlXkAKY-.js";import"./index-CPxKlTrn.js";import{T as h,R as p}from"./index-Nw6-Nyi8.js";import{S as g}from"./index-bn_-uOSs.js";import{I as u}from"./index-PldBotYW.js";import{S as x}from"./index-CAPNepFi.js";import{s as m}from"./index-uxmaaX5q.js";import{R as f}from"./DownloadOutlined-CrpZhemE.js";import"./index-DVfEaQXd.js";import"./statusUtils-DwJfUzs0.js";import"./RightOutlined-5HERV0PD.js";import"./collapse-BIO5DT9H.js";import"./index-BG3s4Knf.js";import"./EllipsisOutlined-FR-wkGpY.js";import"./TextArea-CC7gyy6i.js";import"./SearchOutlined-BJOGTRFw.js";var y={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M909.1 209.3l-56.4 44.1C775.8 155.1 656.2 92 521.9 92 290 92 102.3 279.5 102 511.5 101.7 743.7 289.8 932 521.9 932c181.3 0 335.8-115 394.6-276.1 1.5-4.2-.7-8.9-4.9-10.3l-56.7-19.5a8 8 0 00-10.1 4.8c-1.8 5-3.8 10-5.9 14.9-17.3 41-42.1 77.8-73.7 109.4A344.77 344.77 0 01655.9 829c-42.3 17.9-87.4 27-133.8 27-46.5 0-91.5-9.1-133.8-27A341.5 341.5 0 01279 755.2a342.16 342.16 0 01-73.7-109.4c-17.9-42.4-27-87.4-27-133.9s9.1-91.5 27-133.9c17.3-41 42.1-77.8 73.7-109.4 31.6-31.6 68.4-56.4 109.3-73.8 42.3-17.9 87.4-27 133.8-27 46.5 0 91.5 9.1 133.8 27a341.5 341.5 0 01109.3 73.8c9.9 9.9 19.2 20.4 27.8 31.4l-60.2 47a8 8 0 003 14.1l175.6 43c5 1.2 9.9-2.6 9.9-7.7l.8-180.9c-.1-6.6-7.8-10.3-13-6.2z"}}]},name:"reload",theme:"outlined"};function b(){return b=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e},b.apply(this,arguments)}const v=(t,i)=>e.createElement(d,b({},t,{ref:i,icon:y})),w=e.forwardRef(v),{TextArea:j}=u,{Title:S,Text:C}=h,k=()=>{const[d]=t(),h=i(),{isAuthenticated:y}=r(),b=d.get("id"),v=n(),[C,k]=e.useState(""),[z,M]=e.useState(1024),[T,R]=e.useState(1024),[B,A]=e.useState(""),[O,I]=e.useState(!1),[W,q]=e.useState(null),[E,F]=e.useState(!1),D=[{value:"1:1",label:"1:1 æ­£æ–¹å½¢",width:1024,height:1024},{value:"4:3",label:"4:3 æ ‡å‡†",width:1024,height:768},{value:"16:9",label:"16:9 å®½å±",width:1024,height:576},{value:"9:16",label:"9:16 ç«–å±",width:576,height:1024},{value:"3:2",label:"3:2 ç›¸æœº",width:1024,height:683},{value:"2:3",label:"2:3 ç«–ç‰ˆç›¸æœº",width:683,height:1024}],[H,L]=e.useState("1:1");e.useEffect(()=>{const e=D.find(e=>e.value===H);e&&(M(e.width),R(e.height))},[H]);const{data:$,isLoading:G,error:Y}=s({queryKey:["ImageGenerator-"+b],queryFn:async()=>{if(!b)return null;const e=await v.get(`/square/posts/${b}`,{});if(e?.data){const t=e.data?.preview?.description||e.data.title;t&&k(t);const i=e.data.preview?.width,r=e.data.preview?.height;if(i&&r){const e=parseFloat((i/r).toFixed(2));let t="1:1";Math.abs(e-1.33)<.1?t="4:3":Math.abs(e-1.78)<.1?t="16:9":Math.abs(e-.56)<.1?t="9:16":Math.abs(e-1.5)<.1?t="3:2":Math.abs(e-.67)<.1&&(t="2:3"),L(t)}}return e.data},enabled:!!b,staleTime:0,onError:e=>{console.error("è·å–å›¾ç‰‡è¯¦æƒ…å¤±è´¥:",e)}}),[K,P]=e.useState("");return a("div",{style:{minHeight:"100vh",display:"flex",flex:1},children:[a("div",{style:{width:"300px",padding:"24px",boxShadow:"0 20px 40px rgba(0,0,0,0.1)",height:"100vh",overflowY:"auto"},children:[l(S,{level:4,style:{marginBottom:"24px",color:"#1a1a1a"},children:"ç”Ÿæˆè®¾ç½®"}),a(g,{direction:"vertical",size:"large",style:{width:"100%",display:"flex"},children:[a("div",{children:[l("label",{style:{display:"block",marginBottom:"12px",fontWeight:"600",color:"#333"},children:"å›¾ç‰‡æè¿°"}),l(j,{value:C,onChange:e=>k(e.target.value),placeholder:"æè¿°æ‚¨æƒ³è¦ç”Ÿæˆçš„å›¾ç‰‡ï¼Œä¾‹å¦‚ï¼šä¸€åªå¯çˆ±çš„å°çŒ«åœ¨èŠ±å›­é‡Œç©è€...",rows:4,maxLength:500,showCount:!0,style:{borderRadius:"8px",fontSize:"14px"}})]}),a("div",{children:[l("label",{style:{display:"block",marginBottom:"12px",fontWeight:"600",color:"#333"},children:"å®½é«˜æ¯”"}),l("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"12px",marginBottom:"16px",width:"100%"},children:D.map(e=>{const t=Math.round(e.height/e.width*40);return a("div",{onClick:()=>L(e.value),style:{padding:"12px",border:"2px solid "+(H===e.value?"#667eea":"#d9d9d9"),borderRadius:"8px",cursor:"pointer",textAlign:"center",backgroundColor:H===e.value?"rgba(102, 126, 234, 0.05)":"white",transition:"all 0.3s ease",boxShadow:H===e.value?"0 2px 8px rgba(102, 126, 234, 0.2)":"none",boxSizing:"border-box"},onMouseEnter:t=>{H!==e.value&&(t.currentTarget.style.borderColor="#667eea",t.currentTarget.style.backgroundColor="rgba(102, 126, 234, 0.02)")},onMouseLeave:t=>{H!==e.value&&(t.currentTarget.style.borderColor="#d9d9d9",t.currentTarget.style.backgroundColor="white")},children:[l("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",marginBottom:"8px",minHeight:"60px"},children:l("div",{style:{width:40,height:t,backgroundColor:"#f0f2f5",borderRadius:"4px",border:"1px solid #d9d9d9"}})}),l("div",{style:{fontSize:"13px",fontWeight:"600",marginBottom:"2px"},children:e.label.split(" ")[0]}),a("div",{style:{fontSize:"11px",color:"#666"},children:[e.width,"Ã—",e.height]})]},e.value)})}),a("div",{style:{textAlign:"center",color:"#666",fontSize:"14px"},children:["å®é™…å°ºå¯¸: ",z,"px Ã— ",T,"px"]})]}),a("div",{children:[l("label",{style:{display:"block",marginBottom:"12px",fontWeight:"600",color:"#333"},children:"éšæœºç§å­"}),l(u,{value:B,onChange:e=>A(e.target.value),placeholder:"ç•™ç©ºåˆ™éšæœºç”Ÿæˆ",suffix:l(c,{type:"text",icon:l(w,{}),onClick:()=>{const e=Math.floor(1e6*Math.random());A(e.toString()),q(e)},style:{color:"#667eea"},children:"éšæœº"}),style:{borderRadius:"8px"}})]}),l(c,{type:"primary",size:"large",onClick:async()=>{if(y)if(C.trim()){if(B.trim())q(parseInt(B));else{const e=Math.floor(1e6*Math.random());q(e),A(e.toString())}F(!0),I(!0);try{const e=await v.post("/aigc/generate/image",{prompt:C,width:z,seed:null!==W?W:42,height:T,n:1,quality:"auto",style:"vivid"});I(!1),P(e?.data?.images?.[0]?.url||"")}catch(e){I(!1),P(""),console.error("å›¾ç‰‡ç”Ÿæˆå¤±è´¥:",e),m.error("å›¾ç‰‡ç”Ÿæˆå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•")}}else m.warning("è¯·è¾“å…¥å›¾ç‰‡æè¿°");else m.warning("è¯·å…ˆç™»å½•")},loading:O,style:{width:"100%",height:"48px",borderRadius:"8px",fontSize:"16px",fontWeight:"600",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",border:"none"},children:O?"ç”Ÿæˆä¸­...":"ç”Ÿæˆå›¾ç‰‡"})]})]}),a("div",{style:{flex:1,padding:"24px",height:"100vh",overflowY:"auto",display:"flex",flexDirection:"column"},children:[l(S,{level:4,style:{marginBottom:"24px",color:"#1a1a1a"},children:"ç”Ÿæˆç»“æœ"}),l("div",{style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",padding:"20px 0"},children:a("div",K&&""!==K&&E&&C?O?{style:{textAlign:"center",padding:"40px"},children:[l(x,{size:"large"}),l("div",{style:{marginTop:"16px",color:"#666"},children:"æ­£åœ¨ç”Ÿæˆå›¾ç‰‡ï¼Œè¯·ç¨å€™..."})]}:{style:{width:"100%",textAlign:"center"},children:[l("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",width:"100%",height:"100%"},children:l("img",{src:K,alt:"Generated",style:{maxWidth:"100%",maxHeight:"80vh",boxShadow:"0 10px 30px rgba(0,0,0,0.15)",objectFit:"contain"}})}),l("div",{style:{marginTop:"24px",display:"flex",justifyContent:"center"},children:a(g,{size:"middle",children:[l(c,{icon:l(f,{}),onClick:async()=>{try{let e;if(o)e=await window.electron.downloadFile(K,`generated-${Date.now()}.png`),e.success?m.success(e.message||"ä¸‹è½½æˆåŠŸï¼"):m.error(e.message||"ä¸‹è½½å¤±è´¥");else{const e=document.createElement("a");e.href=K,e.download=`generated-${Date.now()}.png`,e.click(),m.success("ä¸‹è½½å·²å¼€å§‹")}}catch(e){console.error("ä¸‹è½½å¤±è´¥:",e),m.error("ä¸‹è½½å¤±è´¥: "+e.message)}},style:{borderRadius:"8px"},children:"ä¸‹è½½å›¾ç‰‡"}),l(c,{icon:l(p,{}),onClick:()=>navigator.clipboard.writeText(K),style:{borderRadius:"8px"},children:"å¤åˆ¶é“¾æ¥"}),l(c,{type:"primary",size:"default",onClick:()=>{(async()=>{C.trim()?(m.success("å‘å¸ƒæˆåŠŸ"),h("/")):m.warning("è¯·è¾“å…¥å›¾ç‰‡æè¿°")})()},style:{borderRadius:"8px",fontWeight:"600",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",border:"none"},children:"å‘å¸ƒå›¾ç‰‡"})]})})]}:{style:{textAlign:"center",padding:"60px 20px",color:"#999"},children:[l("div",{style:{fontSize:"48px",marginBottom:"16px"},children:"ğŸ¨"}),l("div",{style:{fontSize:"16px",marginBottom:"8px"},children:"è¿˜æ²¡æœ‰ç”Ÿæˆå›¾ç‰‡"}),l("div",{style:{fontSize:"14px"},children:"è¯·åœ¨å·¦ä¾§è¾“å…¥æè¿°å¹¶ç‚¹å‡»ç”ŸæˆæŒ‰é’®"})]})})]})]})};export{k as default};
